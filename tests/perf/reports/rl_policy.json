{
  "protocol": "AGENT3_HANDSHAKE",
  "protocol_version": "v27",
  "version": "1.0.0",
  "timestamp": "2026-01-09T00:00:00Z",
  "type": "reinforcement_learning_policy",
  "phase": "D",
  "integration": {
    "primary_app": "A5_student_pilot",
    "telemetry_endpoint": "A8_auto_com_center",
    "orchestration": "A3_scholarship_agent"
  },
  "reward_function": {
    "formula": "0.05*page_view + 0.3*lead + 0.65*checkout - 0.4*complaint",
    "weights": {
      "page_view": 0.05,
      "lead": 0.3,
      "checkout": 0.65,
      "complaint": -0.4
    },
    "normalization": "min_max",
    "discount_factor": 0.95,
    "reward_clipping": {
      "enabled": true,
      "min": -1.0,
      "max": 1.0
    }
  },
  "error_correction": {
    "retry_policy": {
      "max_retries": 3,
      "base_delay_ms": 1000,
      "max_delay_ms": 10000,
      "exponential_base": 2,
      "jitter": {
        "enabled": true,
        "type": "full",
        "range_percent": 25
      }
    },
    "circuit_breaker": {
      "enabled": true,
      "failure_threshold": 5,
      "recovery_timeout_ms": 30000,
      "half_open_max_requests": 3,
      "monitoring_period_ms": 60000,
      "states": ["CLOSED", "OPEN", "HALF_OPEN"],
      "transitions": {
        "CLOSED_to_OPEN": "failure_count >= failure_threshold",
        "OPEN_to_HALF_OPEN": "recovery_timeout elapsed",
        "HALF_OPEN_to_CLOSED": "success_count >= half_open_max_requests",
        "HALF_OPEN_to_OPEN": "any failure in half_open state"
      }
    },
    "fallback": {
      "enabled": true,
      "strategy": "graceful_degradation",
      "fallback_endpoints": [
        "A2_scholarship_api",
        "local_cache"
      ]
    }
  },
  "auto_rollback": {
    "enabled": true,
    "trigger_conditions": {
      "negative_reward_delta": {
        "threshold": -0.1,
        "window_minutes": 15,
        "min_samples": 100
      },
      "error_rate_spike": {
        "threshold_percent": 5,
        "baseline_window_hours": 24
      },
      "latency_degradation": {
        "p95_threshold_ms": 500,
        "p99_threshold_ms": 1000
      }
    },
    "rollback_strategy": {
      "type": "immediate",
      "target": "previous_stable_policy",
      "notification": {
        "channels": ["A8_telemetry", "slack_alerts"],
        "severity": "high"
      }
    },
    "cooldown_period_minutes": 30
  },
  "hitl_gates": {
    "enabled": true,
    "risk_levels": {
      "low": {
        "auto_approve": true,
        "notification": false
      },
      "medium": {
        "auto_approve": false,
        "requires_approval": true,
        "approvers": ["policy_admin", "ml_engineer"],
        "timeout_hours": 24,
        "notification": true
      },
      "high": {
        "auto_approve": false,
        "requires_approval": true,
        "approvers": ["ceo", "cto", "policy_admin"],
        "timeout_hours": 48,
        "notification": true,
        "requires_documentation": true
      },
      "critical": {
        "auto_approve": false,
        "requires_approval": true,
        "approvers": ["ceo"],
        "timeout_hours": 72,
        "notification": true,
        "requires_documentation": true,
        "requires_rollback_plan": true
      }
    },
    "policy_change_classification": {
      "weight_adjustment_lt_10_percent": "low",
      "weight_adjustment_10_to_25_percent": "medium",
      "weight_adjustment_gt_25_percent": "high",
      "new_reward_signal_added": "medium",
      "reward_signal_removed": "high",
      "algorithm_change": "critical"
    }
  },
  "learning_parameters": {
    "learning_rate": 0.001,
    "batch_size": 64,
    "update_frequency_minutes": 15,
    "exploration_rate": {
      "initial": 0.3,
      "decay": 0.995,
      "minimum": 0.05
    },
    "experience_replay": {
      "enabled": true,
      "buffer_size": 100000,
      "priority_sampling": true
    }
  },
  "monitoring": {
    "metrics": [
      "cumulative_reward",
      "average_reward_per_episode",
      "policy_entropy",
      "value_loss",
      "action_distribution"
    ],
    "alert_thresholds": {
      "reward_drop_percent": 20,
      "entropy_below": 0.1,
      "value_loss_above": 1.0
    },
    "reporting": {
      "destination": "A8_telemetry",
      "frequency_minutes": 5,
      "format": "json"
    }
  },
  "validation": {
    "a_b_test_holdout_percent": 10,
    "shadow_mode_enabled": true,
    "canary_deployment": {
      "enabled": true,
      "initial_traffic_percent": 5,
      "ramp_schedule_hours": [1, 4, 12, 24],
      "success_criteria": {
        "error_rate_lt": 1,
        "latency_p95_lt_ms": 200,
        "reward_delta_gt": -0.05
      }
    }
  }
}
