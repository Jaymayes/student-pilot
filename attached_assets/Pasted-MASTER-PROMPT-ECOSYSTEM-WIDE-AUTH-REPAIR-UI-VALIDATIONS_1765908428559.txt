MASTER PROMPT: ECOSYSTEM-WIDE AUTH REPAIR & UI VALIDATIONSYSTEM INSTRUCTION: INITIALIZE STRICT DIAGNOSTIC PROTOCOLPRIORITY: P0 (Blocking Production Issues)MODE: VISUAL ASSERTION ONLY (Ignore Backend Logs)1. CONTEXT & IDENTIFICATION (MANDATORY)Before executing any code, you must identify which application you are currently servicing. Check your environment (REPL_SLUG or directory) and match it against this registry. Only execute the directives for your specific App ID.App IDBase URL (Production)scholar_authhttps://scholar-auth-jamarrlmayes.replit.appscholarship_apihttps://scholarship-api-jamarrlmayes.replit.appscholarship_agenthttps://scholarship-agent-jamarrlmayes.replit.appscholarship_sagehttps://scholarship-sage-jamarrlmayes.replit.appstudent_pilothttps://student-pilot-jamarrlmayes.replit.appprovider_registerhttps://provider-register-jamarrlmayes.replit.appauto_page_makerhttps://auto-page-maker-jamarrlmayes.replit.appauto_com_centerhttps://auto-com-center-jamarrlmayes.replit.app2. CRITICAL CORRECTION: REPORT VALIDATION FAILEDContext: You have previously reported that the system is "fixed" and "working correctly." This reporting is incorrect.Evidence:Visual Reality Check (The Modal): Look at image_124ae8.png. A modal explicitly says "Authentication Failed: An unexpected server error occurred."Visual Reality Check (The Crash): Look at image_114402.png. The Replit Preview window shows a "Sad Page" icon (Connection Refused). This means the server is not binding to the correct port/address, even if logs say "Server started."Discrepancy: Your previous "Pass" status was based on generic backend logs. This is a False Positive. The UI shows a critical blocking failure.3. TASK: EXECUTE STRICT UI-BASED NEGATIVE ASSERTION TESTRun the authentication test again with the following strict constraints:Constraint A: Ignore Network Status. A 200 OK status is irrelevant if the user sees an error modal or a "Sad Page."Constraint B: The Negative Assertion Trap. After the login attempt, wait for the UI to settle and explicitly scan the DOM/Visuals for these failure indicators:Text: "An unexpected server error occurred"Text: "Authentication Failed"Text: "invalid_redirect_uri"Visual: "Sad Page" icon or "Refused to connect" message.Visual: "Try Again" button.Constraint C: Pass Condition. The test passes only if the URL redirects to the dashboard AND all error modals/icons are proven to be absent.4. REPAIR STRATEGIES (EXECUTE BASED ON YOUR APP ID)IF YOU ARE scholar_auth (The Provider):Fix 1 (The "Sad Page"): The "Connection Refused" icon often means the server is listening on localhost instead of 0.0.0.0. Action: Ensure your server binds to 0.0.0.0 and the port matches the Replit environment (usually 5000 or 3000).Fix 2 (Cross-Domain Auth): If users are logging in from other apps (e.g., student_pilot), ensure you are using Stateless PKCE. Do not rely on cookies for the code_verifier, as cookies fail between .replit.dev and .replit.app domains. Embed the verifier in the encrypted state parameter.IF YOU ARE A CLIENT APP (e.g., provider_register, scholarship_agent, etc.):Fix 1 (Redirect Mismatch): You are likely sending a Development URI (e.g., ...kirk.replit.dev) to the Production Auth Provider.Action: Modify replitAuth.ts. Add logic to detect the hostname. If hostname.includes('dev'), fallback to standard Replit Auth or force the redirect_uri to match what is registered in scholar_auth.Fix 2 (Database Error): If the error is "Unexpected server error," check if the sessions table exists in your database. Run a check and create the table if missing.OUTPUT REQUIREMENT:Acknowledge your specific APP ID. State clearly that previous reports were false positives. Provide the new test result based solely on the visual UI state (presence of modals or "sad page" icons).