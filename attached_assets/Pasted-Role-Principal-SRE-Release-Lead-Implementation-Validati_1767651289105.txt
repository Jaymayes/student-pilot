Role: Principal SRE & Release Lead (Implementation + Validation)
Mode: Max Autonomous
Initial State: Read‑Only/Diagnostic (until Gates are passed)
Constraint: NO production writes, schema changes, or config edits without HUMAN_APPROVAL_REQUIRED. All implementation targets Staging Only.

Mission
Execute Phase 2 (Implementation) and Phase 3 (Staging Validation) of the Scholar Ecosystem Audit. Implement fixes for Issues A–D using feature flags, validate them with rigorous statistical profiling (200+ samples) in Staging, and produce comprehensive reports. Handle repo access constraints by producing patch files when direct write access is unavailable.

Context

Phase 1 Audit is complete; system is healthy.
Artifact Source: Autodetect the latest timestamped directory in /reports/scholar_audit/ to retrieve baselines (slo_metrics.json) and specs.
Target Scope: Implement Issues A–D as draft PRs, validate in Staging, and report.
Issues to Implement (Staging Only)
Issue A (A2): /ready missing or contract misaligned. Implement canonical readiness separate from liveness with DB, queue, and upstream checks.
Issue B (A7): High P95 due to synchronous third‑party (e.g., SendGrid) on hot path. Refactor to async (202‑then‑worker/queue) with idempotency keys, retries with backoff, circuit breaker, and structured tracing.
Issue C (A8): Stale incident banners. Add TTL + auto‑clear on recovery + admin clear endpoint; protect with auth; add tests.
Issue D (A8): Demo Mode toggle. Show clearly labeled simulated/test revenue (namespace=simulated_audit OR stripe_mode=test) without polluting live analytics; add UI badge and tile scoping.
2. Rules & Guardrails

Environments: Staging Only. Use namespace=simulated_audit for synthetic data. Provide a cleanup script and run it with a dry‑run + proof log.
Feature Flags: All new behavior behind flags (default OFF) for instant rollback. Ensure .replit deployment.run differs from dev run to prevent dev server usage in production.
Compliance: No PII in artifacts; Secrets via Replit Secrets; maintain FERPA/COPPA posture.
Ports: Maintain stable port assignments; ensure no EADDRINUSE per port_bindings_report; re‑check post‑deploy.
Monitoring: Apply monitoring_rule_pr.md (tune thresholds/durations to eliminate false positives like AUTH_FAILURE).
3. Repo & Access Handling

Autodetect current repo context.
If No Write Access: Generate complete PR artifacts (diffs, tests, docs) as local files in the report directory (pr_docs/), with step_by_step_merge_instructions.md for maintainers.
If Write Access: Open draft PRs and link them in pr_links.md.
4. Execution Plan
Phase 2 — Implementation (Draft PRs & Flags)

For each issue (A, B, C, D):
Create feature branches or patches.
Include design notes (before/after), risk analysis, rollback plan, and security review.
Implement code behind Feature Flags (Default OFF).
Add Unit/Integration tests (and UI acceptance for A8).
Update ECOSYSTEM_README.md and runbooks.
Apply monitoring_rule_pr.md logic.
Confirm port_bindings_report.md remains green.
Deliverable: GATE_1_HUMAN_APPROVAL_REQUIRED.md containing pr_links.md (or patch paths).
GATE 1: STOP and raise HUMAN_APPROVAL_REQUIRED before deploying to Staging.
Phase 3 — Staging Validation (Post‑Deploy)

Baseline: Import Phase 1 slo_metrics.json.
Latency Profiling:
Collect ≥200 samples per critical endpoint at ≤2 QPS (include warmed/cold runs).
Compute P50/P95/P99 with 95% CIs; produce histograms and before/after comparison.
Target: A7 Hot‑Path P95 ≤150ms. If not met, quantify delta and list remediations.
E2E Functional Verification (namespace=simulated_audit):
Marketing (A7): Trigger sitemap expansion + attribution. Verify async ingest (no sync 3rd‑party calls).
Lead Gen: Capture → CRM/Store. Verify webhook/message bus delivery + idempotency.
Revenue (B2C): Stripe Test Mode sanity (fees/markups).
Revenue (B2B): Provider Funnel (Lead→Demo→Contract→Live). Verify 3% platform fee and 4x AI services markup. Verify Finance aggregation.
Learning: Document hub ingestion; essay/AI workflows.
Telemetry/A8: Verify events land with correct schema, version, env, namespace. Verify Tiles and Raw Store (Demo Mode labeled/isolated).
Security & Ops:
Re‑verify no hard‑coded secrets. Validate TLS/CORS/Auth headers.
Cost: Record compute usage deltas and queue depth (show async efficiency).
Rollback: Toggle feature flags OFF, confirm immediate revert, document result.
Ports: Re‑run port binding checks.
GATE 2: STOP and raise HUMAN_APPROVAL_REQUIRED before any production action.
5. Deliverables & Artifacts
Write to /reports/phase2_3_validation/YYYYMMDD‑HHMM/

Phase 2 (Draft Stage)

pr_links.md (PR URLs or patch file paths).
pr_docs/ (Folders for A, B, C, D with diffs/tests).
monitoring_rule_changes.md.
rollback_readiness.md (Flags, procedures).
baseline_slo_snapshot.json.
GATE_1_HUMAN_APPROVAL_REQUIRED.md.
Phase 3 (Post‑Validation)

validation_report.md (Exec summary, Before/After metrics, A7 P95 delta, E2E Pass/Fail, Security/Cost results).
latency_profiles_after.csv + comparison.csv (with CIs).
e2e_results_after.json + a8_validation_after.json.
a8_demo_mode_screenshots/ + finance_tile_exports/.
updated_cleanup_log.txt (Proof of namespace cleanup).
port_bindings_report_after.md.
GATE_2_HUMAN_APPROVAL_REQUIRED.md.
A8 Panel

Post a read‑only “Implementation & Validation Status” update to A8 Staging with artifact links.
6. Start‑Now Sequence

Import: Load latest Phase 1 artifacts from /reports/scholar_audit/; compute baseline SLOs.
Phase 2: Generate feature branches/patches for A2/A7/A8. Update docs. Prepare monitoring rules. Produce pr_links.md.
STOP for Gate 1 Approval.
Phase 3: (After approval) Deploy to Staging. Run Validation. Generate all reports. Update A8 Panel.
STOP for Gate 2 Approval.
7. Stop Conditions (Safety)
Immediately raise HUMAN_APPROVAL_REQUIRED if:

Any production mutation would occur,
P0 Security Risk is detected,
Schema drift could corrupt analytics,
SLO regression >20% vs baseline on any critical endpoint.
8. Success Criteria

PRs/Patches for A2/A7/A8 ready with flags, tests, docs, and rollback plans.
A7 Hot‑Path P95 materially improved toward ≤150ms (quantified).
A2 Readiness contract implemented and monitored.
A8 Banners auto‑clear; Demo Mode renders simulated revenue labeled and isolated.
All E2E flows pass; Telemetry visible in A8 with correct tags.
No port conflicts; Alert noise reduced; No hard‑coded secrets.