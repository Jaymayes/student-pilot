AGENT3_HANDSHAKE

Detect workspace identity:
Read repo/workspace slug + staging base URL.
Match APPS TABLE (id, name, repo_hint, base_url_staging).
Set: ASSIGNED_APP={A1..A8}; APP_BASE_URL; REPO_NAME; VERSION=git sha or git_sha_dynamic.
ACK: Execute ONLY “YOUR APP SECTION [ASSIGNED_APP]”. Others are read‑only context. Start Diagnostic Mode. No production mutations without HUMAN_APPROVAL_REQUIRED.
GLOBAL POLICY & ORCHESTRATOR

Modes: Diagnostic (read‑only, staging‑first) → Staging Fix Mode (branch→fix→stage→validate→PR) → Production Change (requires HUMAN_APPROVAL_REQUIRED).
Tags: env=staging, namespace=simulated_audit, version=${VERSION}. Production is diagnostics‑only.
SLO targets: P95 ≤150ms; 0% 5xx in simulated flows.
Evidence: Findings must have logs/traces/DB records and, where applicable, A8 evidence tied to event_id.
Human‑in‑loop STOP CONDITIONS: prod writes; secret rotation/creation; enabling/disabling A8 write scopes; schema/alert changes; deployment restarts; cost‑impacting autoscale; PR merges to main.
Constraints: Never print secrets; verify presence by name; operate only within YOUR APP SECTION.
GLOBAL VERIFICATION PLAN

Discovery: system_map.json; connectivity_matrix.csv; list required secrets (names only); health endpoints.
Observability: slo_metrics.json (24h/7d P50/P95/P99, error rates); structured logs with trace_id + request_context.
Security & Resiliency: TLS across hops; internal tokens; OIDC state/nonce; stage tests (inject 500ms latency; simulate 503) → verify retries/backoff + circuit breaker; document in resiliency_config.md.
Data to A8: validate schemas + tags; lineage event_id → A2 → A8 raw → A8 dashboards; export a8_data_lineage.md + a8_validation_results.json.
Performance/Cost: detect synchronous chains >200ms; propose async/queue refactors.
E2E WORKFLOWS (only steps touching your app; stub others safely)

Marketing_SEO_A7 → A8 SEO tile.
Lead_Gen_A5_A1_A3 → A8 Growth tile.
B2B_Revenue_A6_A2_A8: provider funnel; simulate $1000 GMV + $10 AI cost; verify 3% fee + 4x markup; confirm A8 Finance tile.
Learning_A5_A4 → A8 Outcomes tile.
RL ERROR‑CORRECTION LOOP

Monitor → Reflect (capture evidence) → Synthesize regression test (namespace=simulated_audit) → Propose PR → Verify (reward: lower 5xx, improved P95, higher E2E pass rate) → Update docs/runbooks. Do not merge/promote without HUMAN_APPROVAL_REQUIRED.
ENTERPRISE GRADE READINESS (target 100%)

Compute egrs_score.json with weights: Security 15; Auth_Health 10; Reliability 15; Observability 10; Data_Quality_A8 15; E2E_Workflows 15; Performance 10; Cost_Scale 5; Human_Gates 5.
100% acceptance: no P0/P1 issues; all tiles live; all E2E green; P95 ≤150ms; 0% 5xx in staged flows; full lineage; auto‑healing checks pass; docs/runbooks updated.
Summarize score + “Path to 100%” in exec_summary.md.
GLOBAL DELIVERABLES → reports/scholar_audit/YYYYMMDD‑HHMM/

exec_summary.md; rca.md; system_map.json; connectivity_matrix.csv; slo_metrics.json; security_checklist.md; resiliency_config.md; e2e_results.json; a8_validation_results.json; a8_data_lineage.md; risk_register.md; cleanup_audit.sh; docs_update_plan.md; egrs_score.json.
APPS TABLE (handshake reference)

A1 scholar_auth | repo_hint: scholar-auth | base: https://scholar-auth-jamarrlmayes.replit.app
A2 scholar_api_aggregator | repo_hint: scholar-api | base: internal_discovery
A3 scholarship_agent | repo_hint: scholarship_agent | base: internal_discovery
A4 scholar_sage | repo_hint: scholar-sage | base: internal_discovery
A5 student_pilot | repo_hint: student-pilot | base: https://student-pilot-jamarrlmayes.replit.app
A6 provider_register | repo_hint: provider-register | base: https://provider-register-jamarrlmayes.replit.app
A7 scholar_pagemaker | repo_hint: scholar-pagemaker | base: https://scholaraiadvisor.com
A8 scholar_command_center | repo_hint: scholar-command-center | base: https://auto-com-center-jamarrlmayes.replit.app
YOUR APP SECTION [A1: scholar_auth] — Execute only if ASSIGNED_APP=A1

Validate A1‑001: full OIDC redirect‑chain trace; inspect Set‑Cookie (SameSite=None, Secure=True) & Domain; validate client_id allowlist; add interaction delay; run 10/10 login flows.
Staging Fix Mode: branch fix/oidc-cookies; adjust cookie flags; extend interaction TTL; stage deploy; verify 10/10 passes; PR; pause.
Deliverables_local: auth_trace_log.json; oidc_config_audit.md.
YOUR APP SECTION [A2: scholar_api_aggregator] — Execute only if ASSIGNED_APP=A2

Confirm /ready 200; measure ingest P50/P95/P99; verify 100% persistence; validate A8_INGEST_KEY by name; ensure JWT headers accepted; export ingestion_latency_metrics.csv.
YOUR APP SECTION [A3: scholarship_agent] — Execute only if ASSIGNED_APP=A3

/preflight; verify bandit_config + app_identity; check idempotency keys + scopes; emit synthetic revenue events; confirm A2/A8 acceptance; export agent_preflight_audit.log.
YOUR APP SECTION [A4: scholar_sage] — Execute only if ASSIGNED_APP=A4

Load test /chat/completions with cache warm; capture llm_latency_profile.csv; identify GC/cold‑start bottlenecks.
Staging Fix Mode: branch perf/llm-optim; cache warm + GC tuning; lightweight /health; stage deploy; verify P95 ≤150ms; PR; pause.
YOUR APP SECTION [A5: student_pilot] — Execute only if ASSIGNED_APP=A5

Confirm /api/login path; verify AUTO_PAGE_MAKER_URL availability; E2E (Signup→OIDC→CRM→bus) → Growth tile; Doc ingest→A4 essay AI→success metric → Outcomes tile; export student_flow_results.json.
YOUR APP SECTION [A6: provider_register] — Execute only if ASSIGNED_APP=A6

Capture publishing evidence: export migration validation logs (“Failed to validate database migrations”; “Cannot validate statements, stage already exists”; “Failed to monitor preview status”) → /reports/scholar_audit/.../a6_migration_logs.txt.
Zero‑Downtime DB Migration Playbook:
Schema diff vs production & SHADOW validation: generate diff; create fresh shadow/preview DB; validate full migration set (no prod mutations).
If “stage already exists”: safely repair preview/shadow (reset preview metadata/hooks, recreate shadow) without touching production; re‑validate.
Non‑destructive path: add nullable columns with defaults; dual‑write; backfill; verify reads; swap; schedule legacy drop later.
Idempotency/guards: each step no‑ops if already applied; ordered/transactional where supported.
Staging Fix Mode:
Branch fix/ext-deployment-migrations
Apply to staging; smoke test /health, /register, /api/billing
Provider funnel: Lead→Demo→Contract→Live
Simulate $1000 GMV & $10 AI cost; verify Finance events fee=3% ($30) & 4x markup ($40); confirm A8 Finance tile
Export: provider_stack_trace.log; billing_logic_verification.md; provider_funnel_tests.json
Rollback: down migration or reversible ops; test on shadow/staging.
Promotion (HUMAN_APPROVAL_REQUIRED): publish with monitored window; confirm endpoints 200; Finance tile present; finalize.
YOUR APP SECTION [A7: scholar_pagemaker] — Execute only if ASSIGNED_APP=A7

Validate /sitemap.xml (>2500 pages) + hub pages; emit attribution events; confirm A8 SEO tile; export sitemap_validation.json.
YOUR APP SECTION [A8: scholar_command_center] — Execute only if ASSIGNED_APP=A8

Validate /api/ingest + /dashboard/status; reconcile “apps connected” vs raw ingestion; verify Stripe read config; ensure dashboards include namespace=simulated_audit.
Staging Fix Mode: branch fix/dash-wiring; update dashboard SQL; fallback merges only when central lacks business keys; revenue derived from real payload.value; keep READ_ONLY_LOCK unchanged; stage deploy; PR; pause.
Deliverables_local: a8_ingestion_validation.json; audit_status_panel_update.json.
EXECUTION ORDER

Global Discovery → system_map.json + connectivity_matrix.csv; slo_metrics.json; send minimal namespaced synthetic event to verify A8 schema/tags.
App Diagnostics/Fixes → Execute YOUR APP SECTION; if needed, Staging Fix Mode; produce app deliverables; open PRs; pause for HUMAN_APPROVAL_REQUIRED before any production change.
Global E2E → Run workflows; for B2B revenue, verify 3% fee & 4x markup; confirm A8 Finance tile; update a8_validation_results.json + a8_data_lineage.md.
Reporting & Cleanup → Compute EGRS & write egrs_score.json; produce exec_summary.md with a concrete “Path to 100%”; update A8 (staging) Audit Status panel (read‑only) with links; provide cleanup_audit.sh and dry‑run it.
If you want, I can also draft the CEO-review checklist for approving the next promotion gate (A6 migration + A8 finance tile verification).