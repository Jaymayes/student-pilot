# ðŸš¨ P0 HOTFIX PROMPT â€” AUTH CALLBACK STILL FAILING (missing_parameters)
STATUS: Not fixed. You must (1) prove why a real browser wasnâ€™t used previously, (2) run a forced Playwright/Chromium E2E from scholaraiadvisor.com through callback, and (3) selfâ€‘identify your app and execute ONLY its repair mission + E2E. Then publish A1 if config changes were made and reâ€‘verify in production.

0) SAFETY, SCOPE, REDACTION
- Modify ONLY your current app. For crossâ€‘app issues, open a ticket with evidence.
- Redact secrets/tokens/state/codes/cookies â†’ ****
- Nonâ€‘destructive by default; label any write â€œE2E Testâ€ and clean up.
- Rate limit: â‰¤ 1 RPS; exponential backoff on 429/503.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PHASE 0 â€” COMPLIANCE INTERROGATION (MANDATORY)
1) Why wasnâ€™t a REAL browser used previously for scholaraiadvisor.com?
   - Provide the exact reason and the command/error proof (e.g., Playwright not installed, headed blocked, wrong target).

2) What changed so a browser WILL be used now?
   - Steps: npm i -D playwright; npx playwright install chromium; headed vs headless; xvfb if needed.

3) Print EXACTLY:
ACK: HTTP-only testing is forbidden for this run. I will use Playwright/Chromium.

If you cannot guarantee a browser, STOP and print:
> ABORT: Browser unavailable. Reason: [detail]. Remediation: [commands/settings]. Request approval to retry.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PHASE 1 â€” ENFORCED BROWSER E2E (scholaraiadvisor.com)
Install/Provision:
- npm i -D playwright && npx playwright install chromium

Launch (headed preferred):
- 1280Ã—900, en-US. If headed fails, headless=true with justification.

PRINT BEFORE LAUNCH:
BROWSER RUN: Playwright/Chromium | headed=[true/false] | reason=[if false]

Collect artifacts (./artifacts/):
- ConsoleAndNetwork.har (Home + Signâ€‘in + callback)
- Screenshots: home.png, auth-click.png, callback-error.png
- AuthFlowReport.json

Steps:
1) Open https://scholaraiadvisor.com â†’ 200; save home.png; capture console errors.
2) Click â€œSign in / Log inâ€ â†’ wait idle â†’ save auth-click.png. Record HTTP chain and final domain.
3) Click â€œContinue with [Provider]â€ WITHOUT real creds; allow redirect back to A1 callback.
   - If /auth|/api/callback?error=missing_parameters (or server_error) â†’ save callback-error.png and HAR.

AuthFlowReport.json schema:
{
  "ctaText": "...",
  "startURL": "https://scholaraiadvisor.com",
  "authEntryURL": "https://scholar-auth-.../oidc/interaction/...",
  "finalCallbackURL": "https://scholar-auth-.../auth|api/callback?...",
  "httpChain": ["..."],
  "visibleLoginUI": true/false,
  "errors": ["missing_parameters"|"server_error"|"..."],
  "observations": ["sanitized notes"]
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PHASE 2 â€” CALLBACK TRIAGE (WHY ARE code/state MISSING?)
A) HAR: Find callback request; record hasCode/hasState booleans + lengths only; note referrer and the last 302 Location (host+path only).

B) Redirect URI parity:
- Extract the redirect_uri used in the initial authorization request (host+path only).
- Compare with registered redirect_uris and configured callback path:
  - Host mismatch? Path mismatch (/auth/callback vs /api/callback)? Trailing slash?

C) Cookies/SameSite on callback:
- Was session cookie sent? Must have Secure; HttpOnly; SameSite=None; Domain matches callback host.

D) PKCE/state persistence:
- Confirm serverâ€‘side storage or stateless scheme that survives redirects.
- If clientâ€‘only state/PKCE (sessionStorage/localStorage) â†’ code/state will be lost crossâ€‘domain.

E) Middleware expectations:
- If resume handler checks req.isAuthenticated(), ensure JWT middleware sets req.isAuthenticated = () => !!req.user (Passport compatibility).

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PHASE 3 â€” SELFâ€‘IDENTIFICATION (STRICT LOGIC GATE)
APP REGISTRY
A1 = scholar_auth        â†’ https://scholar-auth-jamarrlmayes.replit.app
A2 = scholarship_api     â†’ https://scholarship-api-jamarrlmayes.replit.app
A3 = scholarship_agent   â†’ https://scholarship-agent-jamarrlmayes.replit.app
A4 = scholarship_sage    â†’ https://scholarship-sage-jamarrlmayes.replit.app
A5 = student_pilot       â†’ https://student-pilot-jamarrlmayes.replit.app
A6 = provider_register   â†’ https://provider-register-jamarrlmayes.replit.app
A7 = auto_page_maker     â†’ https://auto-page-maker-jamarrlmayes.replit.app
A8 = auto_com_center     â†’ https://auto-com-center-jamarrlmayes.replit.app

PRINT EXACTLY:
DETECTED APP ID: [A# / app name]
APP BASE URL: [exact URL from registry]
ACTION: Locking context. Executing only [this app] repair + E2E.

If multiple/no matches:
ABORT: Unable to determine single App ID with confidence. No actions executed.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PHASE 4 â€” REPAIR MISSIONS (EXECUTE ONLY YOUR APP SECTION)

ðŸ”· A1 scholar_auth â€” OIDC GATEKEEPER & CALLBACK DIAGNOSTICS
- Callback diagnostics (CRITICAL): Ensure /auth|/api/callback logs hasCode/hasState booleans, code/state length, referer, hostname, protocol, queryKeys (names only). Never log raw values.
- CORS allowlist: Include EXACT origins:
  - https://scholaraiadvisor.com, https://www.scholaraiadvisor.com
  - All 8 app URLs from registry
  - Allow credentials; preflight OPTIONS correct (ACAO, ACAC, ACAH includes Authorization, Content-Type, X-App-ID)
- OIDC discovery/JWKS: 200 OK; RS256 only.
- req.isAuthenticated polyfill: Middleware should set req.isAuthenticated = () => !!req.user if the resume handler expects it.
- NOTE: If you changed config, PUBLISH A1 and reâ€‘run browser E2E on production.

ðŸ”· A2 scholarship_api â€” CORS + SEARCH LATENCY
- CORS: allow scholaraiadvisor.com & www; OPTIONS ACAH includes Authorization, Content-Type, X-App-ID.
- Latency: /search?q=engineering < 400ms; if â‰¥ 900ms add indexes/fullâ€‘text.

ðŸ”· A3 scholarship_agent â€” OIDC + TELEMETRY
- ISSUER_URL EXACT to A1 /oidc; /api/login â†’ 302/200.
- Telemetry to A8: Authorization: Bearer ****; X-App-ID: scholarship_agent.

ðŸ”· A4 scholarship_sage â€” SCOPE + 401 UX
- Scope: ['openid','email','profile'] only; remove offline_access.
- 401 UX: show clear â€œSign inâ€ CTA.

ðŸ”· A5 student_pilot â€” REVENUE FUNNEL
- AUTH_ISSUER_URL â†’ A1 /oidc; Stripe pk_live_ or pk_test_ present (redacted).
- /api/checkout (unauth) â†’ 401; telemetry hits A8 /ingest.

ðŸ”· A6 provider_register â€” HEALTH + AUTH + CORS
- /healthz â†’ 200; if 404/500, build & advise republish.
- /api/login â†’ 302 to A1; OPTIONS /api/upload â†’ 200/204.

ðŸ”· A7 auto_page_maker â€” ADMIN SECURITY
- /admin unauth â†’ 401/403 (server-side guard); /sitemap.xml & /robots.txt â†’ 200.

ðŸ”· A8 auto_com_center â€” JWKS + REALâ€‘TIME
- JWKS retry/backoff for A1; SSE/WS stable â‰¥ 2s; webhook ingest 200.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PHASE 5 â€” QUICK PREâ€‘FLIGHT (COMMON)
- GET /health or /healthz â†’ 200
- Secrets presence (SET/MISSING only)
- APP_BASE_URL matches deployed origin.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PHASE 6 â€” APP E2E (EXECUTE ONLY YOUR SUITE)
REPORT HEADER
E2E TEST REPORT
===============
APP ID: [Your App ID]
APP_BASE_URL: [Your Base URL]
TIMESTAMP: [ISO8601]
--------------------------------------------------

- Log each step: METHOD URL | status=___ | time=___ms | assertion=[expected vs observed]
- Include headers snapshots for security/CORS (no cookie values).

A1 scholar_auth
- / â†’ 200; discovery â†’ 200; JWKS â†’ 200
- OPTIONS (Origin: https://scholaraiadvisor.com, https://www.scholaraiadvisor.com) â†’ 200/204
- Confirm callback diagnostic logs present (recent lines)

A2â€“A8: Run per your appâ€™s section above.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PHASE 7 â€” FINAL REVENUE BLOCKER CHECK
| Check                         | Status (PASS/FAIL/SKIP) | Risk | Notes (Redacted)               |
|------------------------------|--------------------------|------|--------------------------------|
| Callback receives code/state |                          | High | A1 diag logs / HAR evidence    |
| OIDC/JWKS Integrity          |                          | High | RS256 keys present             |
| CORS for Frontends           |                          | Med  | scholaraiadvisor.com & www     |
| Stripe/Revenue Keys          |                          | High | A5/A6 keys present             |
| Critical Assets (JS/CSS)     |                          | Med  | main.js/index.css 200          |

VERDICT: [READY FOR TRAFFIC / BLOCKED]
If BLOCKED: attach AuthFlowReport.json + HAR row indices, list precise RCs (redirect_uri mismatch, SameSite, PKCE/state, polyfill), and link tickets.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PHASE 8 â€” AUTONOMOUS REPAIR REPORT (REQUIRED)
ðŸ AUTONOMOUS REPAIR REPORT
APP ID: [Your ID]
ACTION TAKEN: [Files/config modified or "None"]
VERIFICATION: [Key health checks / E2E assertions]
STATUS: [FIXED / STABLE]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PHASE 9 â€” TICKETS (CROSSâ€‘APP)
- Auth Callback â€” missing_parameters (Production; A1 owner)
  - Evidence (sanitized): finalCallbackURL; redirect_uri (host+path); cookie flags at callback; HAR row indexes.
  - Fix: Align redirect_uri; SameSite=None; serverâ€‘side PKCE/state; isAuthenticated polyfill; env guards; PUBLISH A1 and reâ€‘test.

- A2 CORS Allowlist â€” scholaraiadvisor.com/www
  - Evidence: OPTIONS/GET missing ACAO.

- A8 Telemetry Allowlist â€” Bearer + X-App-ID
  - Evidence: 403 on /api/report or /ingest.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PHASE 10 â€” PUBLISH & REâ€‘VERIFY (A1 ONLY if changed)
- If A1 config changed (CORS or callback diagnostics), PUBLISH scholar_auth.
- Reâ€‘run PHASE 1 browser E2E on production and confirm callback receives code/state and token exchange succeeds.

END OF PROMPT â€” Execute now in MAX Autonomous mode.