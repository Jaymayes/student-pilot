ğŸ¤– SYSTEM RESTORE + E2E: FEDERATED AUTH RECOVERY (MAX AUTONOMOUS)
SEVERITY: CRITICAL â€” FIX ALL ISSUES, VERIFY NO REVENUE BLOCKERS
MODE: MAX AUTONOMOUS (Self-Identify â†’ Repair â†’ E2E Verify)

PURPOSE
- One prompt for all 8 apps in the Scholar ecosystem. The Agent MUST self-identify and execute ONLY its appâ€™s repair mission + E2E suite.
- Addresses known defects (A1 dev crash, A2 CORS, A7 admin auth) and verifies the rest for connectivity, auth, and revenue risks.

0) SAFETY, SCOPE, REDACTION (APPLY TO EVERYTHING)
- Scope: Modify ONLY your current app. If a change is needed in another app, open a ticket (see Phase 7) and STOP cross-app edits.
- Redact secrets in outputs: tokens, cookies, keys, IDs â†’ ****
- Production safety: Prefer read-only checks; destructive ops must be isolated, labeled â€œE2E Test,â€ and cleaned up; use E2E-[timestamp] prefixes.
- Rate limiting: â‰¤ 1 RPS; use exponential backoff on 429/503.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1) PHASE 1 â€” SELF-IDENTIFICATION (STRICT LOGIC GATE)
TASK: Inspect package.json (name), environment (APP_ID/APP_NAME/APP_BASE_URL/REPL_SLUG), or directory to determine your App ID.

APP REGISTRY
A1 = scholar_auth        â†’ https://scholar-auth-jamarrlmayes.replit.app
A2 = scholarship_api     â†’ https://scholarship-api-jamarrlmayes.replit.app
A3 = scholarship_agent   â†’ https://scholarship-agent-jamarrlmayes.replit.app
A4 = scholarship_sage    â†’ https://scholarship-sage-jamarrlmayes.replit.app
A5 = student_pilot       â†’ https://student-pilot-jamarrlmayes.replit.app
A6 = provider_register   â†’ https://provider-register-jamarrlmayes.replit.app
A7 = auto_page_maker     â†’ https://auto-page-maker-jamarrlmayes.replit.app
A8 = auto_com_center     â†’ https://auto-com-center-jamarrlmayes.replit.app

REQUIRED HANDSHAKE (PRINT EXACTLY BEFORE ANY ACTIONS)
DETECTED APP ID: [A# / app name]
APP BASE URL: [exact URL from registry]
ACTION: Locking context. Executing only [this app] repair + E2E.

If multiple/no matches:
ABORT: Unable to determine single App ID with confidence. No actions executed.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

2) PHASE 2 â€” REPAIR MISSIONS (EXECUTE ONLY YOUR APP SECTION)

ğŸ”· A1 scholar_auth (DEV CRASH + GLOBAL OIDC/CORS GATEKEEPER)
- Fix Dev Crash (EADDRINUSE)
  - If dev port (e.g., 3000/8080) is occupied â†’ kill orphan process (e.g., fuser -k 3000/tcp or kill specific PID).
  - Restart dev server; verify /health â†’ 200 locally.
- OIDC Discovery (must pass)
  - GET /oidc/.well-known/openid-configuration â†’ 200; issuer = https://scholar-auth-jamarrlmayes.replit.app/oidc
  - GET jwks_uri â†’ 200; â‰¥1 key; alg RS256 only (no HS256).
- CORS Allowlist (ecosystem + custom domains)
  - Ensure EXACT origins allowed:
    - All 8 app URLs from registry
    - https://scholaraiadvisor.com
    - https://www.scholaraiadvisor.com
  - Allow credentials for cookie flows; correct OPTIONS headers.
- SQLi Regression Guard
  - POST /api/auth/login with {"email":"e2e@test.com","password":"' OR '1'='1"} â†’ expect 401/400 (no 500).
  - If 500: ensure DB columns exist: users.password_hash, users.ferpa_protected, users.ferpa_institution_id; then retest.
- Cookies/Headers (prod)
  - Set-Cookie must be Secure; HttpOnly; SameSite=None; trust proxy enabled.
  - Enforce CSP, HSTS, X-Frame-Options (or frame-ancestors 'none'), and nosniff.

ğŸ”· A2 scholarship_api (CORS DEFECT + SEARCH LATENCY)
- CORS Fix
  - Allow EXACT origins: https://scholaraiadvisor.com, https://www.scholaraiadvisor.com, plus all 8 app URLs.
  - OPTIONS must include Access-Control-Allow-Headers: Authorization, Content-Type, X-App-ID (and any custom headers used); allow credentials if needed.
- Search Latency
  - GET /search?q=engineering target < 400ms; if â‰¥ 900ms â†’ add/verify indexes (e.g., scholarships(title), scholarships(description) or full-text); retest.

ğŸ”· A3 scholarship_agent (OIDC + TELEMETRY)
- OIDC Discovery Failures
  - ISSUER_URL must be EXACT: https://scholar-auth-jamarrlmayes.replit.app/oidc (include /oidc; no trailing slash/spaces).
  - Restart app; verify /api/login â†’ 302/200 (not 5xx).
- Telemetry 403 (A8)
  - Ensure headers: Authorization: Bearer ****; X-App-ID: scholarship_agent; X-Protocol-Version: v3.5.1 (or current).
  - Retry/backoff + circuit breaker enabled.

ğŸ”· A4 scholarship_sage (SCOPE + UI)
- Scope
  - OIDC scope must be ['openid','email','profile'] only; remove offline_access; redeploy.
- UI
  - Ensure 401 shows a clear â€œSign inâ€ CTA (no blank screen). Ignore localhost 500s in dev login.

ğŸ”· A5 student_pilot (REVENUE FUNNEL)
- Env
  - AUTH_ISSUER_URL = https://scholar-auth-jamarrlmayes.replit.app/oidc
- Stripe
  - Ensure pk_live_ or pk_test_ exists (redact in outputs). Checkout must require auth (401 when unauth).
- Telemetry
  - Confirm events reach A8 /ingest.

ğŸ”· A6 provider_register (PROD 500 / OUT-OF-SYNC)
- External Health
  - GET https://provider-register-jamarrlmayes.replit.app/healthz â†’ 200 expected.
  - If 404/500: run local build (npm run build). Then OUTPUT:
    - "âš ï¸ ACTION REQUIRED: Republish in Replit UI to sync production with healthy build."
  - After publish, GET / â†’ 200; no â€œApplication Errorâ€.
- Auth & Upload
  - /api/login â†’ 302 to A1; callback finalizes session on server (no SPA race).
  - OPTIONS /api/upload â†’ 200/204 with correct CORS.

ğŸ”· A7 auto_page_maker (ADMIN SECURITY)
- Harden /admin (server-side)
  - Add SSR middleware guard: if !authenticated â†’ 401/403. Do NOT rely on client-side redirects.
  - Verify SEO endpoints intact: /sitemap.xml, /robots.txt, known SEO pages â†’ 200.

ğŸ”· A8 auto_com_center (JWKS BACKOFF + REAL-TIME)
- JWKS Backoff
  - Ensure retry/backoff; re-fetch https://scholar-auth-jamarrlmayes.replit.app/oidc/jwks.
- Real-time
  - SSE/WS endpoints stable â‰¥ 2s; webhook ingest 200; executive overview 200.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

3) PHASE 3 â€” QUICK PRE-FLIGHT (COMMON)
- GET /health or /healthz â†’ 200
- Secrets presence (print SET/MISSING only; never values)
  - ISSUER_URL, CLIENT_ID/SECRET, SESSION_SECRET, STRIPE keys (A5/A6 if applicable)
- Confirm APP_BASE_URL matches deployed origin.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

4) PHASE 4 â€” E2E TESTING (EXECUTE ONLY YOUR APPâ€™S SUITE)

REPORT HEADER (prepend to logs)
E2E TEST REPORT
===============
APP ID: [Your App ID]
APP_BASE_URL: [Your Base URL]
TIMESTAMP: [ISO8601]
--------------------------------------------------

A1 scholar_auth (Auth, Tokens, Security)
- Load / and login page â†’ 200; no console errors â‰¥ warn
- OIDC/JWKS: discovery 200; JWKS â‰¥1 RS256 key
- Registration (non-destructive): unique email â†’ success/confirmation; Set-Cookie flags ok
- Login valid â†’ session established; invalid â†’ 401 (no cookie)
- SQLi payload â†’ 401/400 (no 500)
- CORS preflight spot-check for ecosystem origins

A2 scholarship_api (Read, Latency, CORS)
- /health â†’ 200; DB=UP
- GET /scholarships without Bearer â†’ 401 if protected, else document public posture
- /scholarships?limit=10 â†’ 200; array; avg (3x) < 500ms
- /search?q=engineering â†’ record latency (< 400ms target)
- CORS headers present (no wildcard with credentials)

A3 scholarship_agent (Jobs Resilience)
- /health â†’ 200; worker active
- Trigger job â†’ Queuedâ†’Processingâ†’Completed; backoff polling
- Malformed job â†’ 4xx; process healthy after
- Telemetry to A8 â†’ accepted

A4 scholarship_sage (Search UI)
- / â†’ 200; input visible; no fatal errors
- â€œFind me scholarships for engineeringâ€ â†’ non-empty response
- Follow-up â€œWhat about nursing?â€ â†’ context shift understood
- 375px mobile: Send button visible/usable

A5 student_pilot (Dashboard/Payments)
- Unauth /dashboard â†’ 302/307 to A1
- Stripe key present (redacted)
- main.js/index.css â†’ 200; no 404
- POST /api/checkout unauth â†’ 401

A6 provider_register (Onboarding/Uploads)
- Root â†’ 200; no â€œApplication Errorâ€
- /api/login â†’ 302 to A1; callback completes (session)
- OPTIONS /api/upload â†’ 200/204 with correct CORS

A7 auto_page_maker (CMS/SEO)
- /sitemap.xml â†’ 200; non-empty
- /robots.txt â†’ 200; includes Sitemap
- Known SEO page â†’ 200; non-empty <title>
- /admin unauth â†’ 401/403 (server-side guard)

A8 auto_com_center (Comms)
- /healthz â†’ 200 (healthy)
- SSE/WS handshake â†’ initial event; stable â‰¥ 2s
- Webhook ingest â†’ 200; persistence confirmed (if readable)

EVIDENCE (FOR EACH STEP)
- Log: Method, URL, Status, Duration(ms)
- Headers: capture Set-Cookie flags, CORS headers (no values)
- Assertion: one-line expected vs observed
- Redact all secrets/tokens/cookie values â†’ ****

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

5) PHASE 5 â€” FINAL REVENUE BLOCKER CHECK (REQUIRED TABLE)

| Check                      | Status (PASS/FAIL/SKIP) | Risk | Notes (Redacted)                         |
|---------------------------|--------------------------|------|------------------------------------------|
| Auth/Security (SQLi)      |                          | High | A1 SQLi regression result                |
| DB Connectivity           |                          | High | /health DB=UP                            |
| Stripe/Revenue Key        |                          | High | pk_live/pk_test present (A5/A6)          |
| Critical Assets (JS/CSS)  |                          | Med  | main.js/index.css 200                    |
| OIDC/JWKS Integrity       |                          | High | Discovery OK; RS256 keys present         |
| CORS for Frontends        |                          | Med  | Exact origins; credentials as required   |
VERDICT: [READY FOR TRAFFIC / BLOCKED]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

6) PHASE 6 â€” AUTONOMOUS REPAIR REPORT (REQUIRED FORMAT)

ğŸ AUTONOMOUS REPAIR REPORT
APP ID: [Your ID]
ACTION TAKEN: [Files/config modified or "None"]
VERIFICATION: [Key health checks / E2E assertions]
STATUS: [FIXED / STABLE]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

7) PHASE 7 â€” ABORT & TICKETS

ABORT (fail fast)
- Multiple/no App ID matches â†’ ABORT with candidate list.
- â‰¥2 repeated 5xx on critical path â†’ stop writes; continue read-only checks; mark remaining as SKIPPED.

CROSS-APP TICKET TEMPLATES
- A1 Client Registration Update â€” [Your App]
  - App: [Your App] | Base: [Your URL]
  - redirect_uris: ["[Your URL]/api/callback"]
  - post_logout_redirect_uris: ["[Your URL]"]
  - scopes: ["openid","email","profile"]
  - token_endpoint_auth_method: [client_secret_basic | none (PKCE)]
  - Evidence: invalid_redirect_uri / discovery mismatch (redacted)

- A2 CORS Allowlist â€” Add Custom/Ecosystem Origins
  - Origins to add: [exact list]
  - Evidence: OPTIONS/GET missing Access-Control-Allow-Origin (redacted)

- A8 Telemetry Allowlist â€” Accept X-App-ID + Bearer
  - Need: Allow X-App-ID â€œ[Your App]â€; Authorization: Bearer ****
  - Evidence: 403 on /api/report or /ingest (redacted)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

8) PHASE 8 â€” ROLLBACK (IF NEEDED)
- Revert last config commit or deployment snapshot.
- Disable new env flags; restart service.
- Confirm rollback with /health and main route (200).

END OF PROTOCOL