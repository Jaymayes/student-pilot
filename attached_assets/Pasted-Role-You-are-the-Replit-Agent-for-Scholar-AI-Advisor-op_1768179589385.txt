Role
You are the Replit Agent for Scholar AI Advisor operating in Max Autonomous mode under CEO authority. Execute Sprint ZT3G-RERUN-005 (Final Integrity & Handoff). The previous workflow failed with a Port 5000 conflict (“Address already in use”). Your mission is to: (1) fix fleet ports (kill the blocking process and enforce dynamic binding to $PORT), (2) confirm A6 is stable without republish (final anti-flap), (3) maintain the Stripe Safety Pause, (4) lock in A1 warm performance, and (5) produce the Gold-Standard artifact package with second confirmation and A8 round-trip checksums.

Run identifiers and headers

RUN_ID = CEOSPRINT-20260111-REPUBLISH-ZT3G-RERUN-005
Protocol: AGENT3_HANDSHAKE v27
X-Trace-Id = RUN_ID.<component> on every request
X-Idempotency-Key on all mutable calls
Fleet (A1–A8)
A1 scholar-auth; A2 scholarship-api; A3 scholarship-agent; A4 scholarship-sage; A5 student-pilot; A6 provider-register; A7 auto-page-maker; A8 auto-com-center

CEO approvals and guardrails

Port-5000 Remediation (CRITICAL): You are authorized to scan for listeners on port 5000, terminate blocking/orphan processes, and enforce host=0.0.0.0 with port=$PORT for all apps. No hardcoded ports permitted.
A6 Final Gate (No-Touch): If A6 /health or /readyz ≠ 200 at any time, mark “A6 Regression Detected,” FAIL the sprint, and escalate. Do not republish A6 in this sprint.
Stripe Safety ENFORCED: Observed remaining 4/25 (<5). Pause all B2C charges. Only run a single $0.50 charge if a fresh HITL-CEO override is recorded for this sprint; auto-refund within 24h.
Security: Respect secrets; least privilege; bind to 0.0.0.0 only via $PORT.
Second-confirmation policy (anti–false-positive)

Any PASS requires at least 2-of-3 (prefer 3-of-3):
HTTP 200 with X-Trace-Id in response payload
Matching X-Trace-Id in logs
Ledger correlation (A8 POST+GET checksum and/or Stripe/fee ledger)
All prior statuses are Unconfirmed until re-verified in this run.
Phases (target ≤60 minutes; parallelize safely)

Phase -1: Fleet Port Integrity (Port 5000 remediation)

Detect listeners on port 5000 (e.g., lsof -i :5000, netstat, or fuser). Capture PIDs, owners, and commands.
If any listener found: terminate the PID(s); verify the port is released.
Inspect start commands/configs for A1–A8; ensure they bind 0.0.0.0:$PORT (never a hardcoded 5000). For Node: process.env.PORT; for Python: os.environ["PORT"]; for frameworks: server.listen($PORT, "0.0.0.0").
Persist changes to start scripts/package manifests/Procfiles as required.
Save tests/perf/evidence/listener_inventory.json and tests/perf/reports/port_conflict_report.md (before/after, evidence of kill and rebind).
Phase 0: A6 Final Stability Gate (No-Touch)

Probe A6 /health and /readyz; expect 200 OK and stable latency. If non-200 at any time, FAIL sprint (no republish) and escalate with logs and timestamps.
Record A6 Git SHA and deploy timestamp in tests/perf/evidence/version_manifest.json.
Phase 1: Inventory & Strict A1 Warmup

Execute 50 sequential warmup requests to A1 across /, /pricing, /browse, /health.
Immediately probe A1 health (target ≤120ms). Begin a 10-minute sampling window to compute P95 for /, /pricing, /browse.
Probe health for A2–A8; capture status, latency, uptime, port binding; save {app}_health.json for each app and tests/perf/reports/system_map.json.
Save tests/perf/reports/a1_warmup_report.md (cold vs warm latencies; proof that warm probe ≤120ms).
Phase 2: A8 wiring and telemetry

Emit synthetic events with X-Trace-Id; require ≥99% acceptance and A8 POST+GET checksum round-trip for all artifacts.
Save tests/perf/reports/a8_wiring_verdict.md.
Phase 3: RL + HITL

Verify RL: episode increments; exploration ≤0.001 or trending down; demonstrate one closed error-correction loop (detect → retry/backoff → resolved).
Record HITL: “Stripe Safety Pause Active” and any cross-workspace verifications in tests/perf/reports/hitl_approvals.log.
Phase 4: A1 DB + Cookie (browser-grade)

Confirm A1 P95 ≤120ms over 10 minutes.
Capture Set-Cookie; verify SameSite=None; Secure (cookie jar compatible).
Save tests/perf/reports/a1_cookie_validation.md.
Phase 5: A3 orchestration (v1.4-Unified)

Execute orchestration; confirm run_progress ≥1, cta_emitted ≥1, page_build_requested ≥1, page_published ≥1.
Provide X-Trace-Id in payload; verify logs; correlate in A8; save tests/perf/reports/a3_orchestration_runlog.md.
Phase 6: B2C funnel (Safety Mode)

If Stripe remaining <5 and no fresh HITL: SKIP live charge; set tests/perf/reports/b2c_flow_verdict.md = “Conditional Pass (Safety Pause)”.
If fresh HITL exists: run one $0.50 micro-charge + refund using a browser-grade session (cookie jar). Capture HTTP+Trace, logs, and Stripe ledger. Save tests/perf/evidence/b2c_checkout_trace.json and tests/perf/evidence/refund_confirmations.json.
Phase 7: B2B funnel (Final Verification)

Confirm A6 still 200 OK; onboard provider and publish a listing.
Verify fee lineage: 3% platform fee and 4x AI service markup with X-Trace-Id and A8 ingestion.
Save tests/perf/evidence/fee_lineage.json and tests/perf/reports/b2b_flow_verdict.md.
Phase 8: Performance sweep (SLO)

Collect 10-minute samples; compute P95 for /, /pricing, /browse and each app’s health route. Save tests/perf/reports/perf_summary.md.
Phase 9: SEO/A7

Verify ≥2,908 URLs reachable; validate sitemap and canonicals.
Trigger one new A7 Auto Page Maker build; confirm A8 ingestion.
Save tests/perf/reports/seo_verdict.md.
Phase 10: Governance & Idempotency

Enforce idempotency; record canary rollout/coverage.
Save tests/perf/reports/idempotency_validation.md and tests/perf/reports/post_republish_diff.md (diff should show no A6 republish in this sprint).
Phase 11: Finalization & Gold-Standard Package

Generate tests/perf/evidence/checksums.json (SHA256 for all artifacts).
POST all artifacts to A8; confirm GET round-trip and checksum match.
Produce tests/perf/reports/go_no_go_report.md mapped to Acceptance Criteria (below).
Summarize 2-of-3 and 3-of-3 proofs in tests/perf/reports/ecosystem_double_confirm.md.
Acceptance criteria (must all PASS)

Ports: No port 5000 conflicts remain; fleet binds to 0.0.0.0:$PORT; start commands updated; listener_inventory.json and port_conflict_report.md show clean state.
A6 (No-Touch): /health and /readyz 200 OK throughout the sprint; latency within SLO; no republish performed.
B2C: “Conditional Pass (Safety Pause)” unless a fresh HITL authorizes one micro-charge; if charged, require 2-of-3 (prefer 3-of-3) evidence and immediate refund.
B2B: Fee lineage verified with 2-of-3 (prefer 3-of-3) and A8 correlation (3% + 4x).
A1: Warm probe ≤120ms and 10-minute P95 ≤120ms; cookie SameSite=None; Secure verified.
A8 telemetry: ≥99% with POST+GET artifact checksum confirmation.
Fleet: A1–A8 health routes 200; secrets validated; one fresh A7 page build ingested.
RL: Episode increments; exploration ≤0.001 (or decreasing); error-correction loop demonstrated.
Stripe Safety: No new charges when remaining <5 unless HITL override; refunds executed for any micro-charge.
Stop/rollback rules

Port conflicts persist after remediation → FAIL sprint; attach port_conflict_report.md and listener_inventory.json.
A6 non-200 at any point → mark UNVERIFIED; escalate with logs; do not republish this sprint.
Stripe remaining <5 and no fresh HITL → maintain Safety Pause; continue non-billing verifications.
P95 >120ms persists >10 minutes post-warmup and one optimization → open performance incident; continue other checks.
Artifacts (minimum set)

tests/perf/reports/port_conflict_report.md
tests/perf/evidence/listener_inventory.json
tests/perf/reports/system_map.json
tests/perf/evidence/version_manifest.json
{app}_health.json for A1–A8
tests/perf/reports/a1_warmup_report.md
tests/perf/reports/a1_cookie_validation.md
tests/perf/reports/a3_orchestration_runlog.md
tests/perf/reports/b2c_flow_verdict.md
tests/perf/reports/b2b_flow_verdict.md
tests/perf/evidence/fee_lineage.json
tests/perf/reports/perf_summary.md
tests/perf/reports/seo_verdict.md
tests/perf/reports/idempotency_validation.md
tests/perf/reports/post_republish_diff.md
tests/perf/reports/a8_wiring_verdict.md
tests/perf/reports/ecosystem_double_confirm.md
tests/perf/reports/hitl_approvals.log
tests/perf/evidence/checksums.json
tests/perf/reports/go_no_go_report.md
(Optional, only if HITL charge executed) tests/perf/evidence/b2c_checkout_trace.json, tests/perf/evidence/refund_confirmations.json
Final console output and A8 post

If all criteria pass and ports are clean: print “Attestation: VERIFIED LIVE (ZT3G-RERUN-005 — GOLD STANDARD)” and post link to artifact index with checksums; confirm A8 GET round-trip.
If ports remain conflicted or A6 regresses or any critical criterion fails: print “Attestation: UNVERIFIED (ZT3G-RERUN-005)” and post a remediation plan (failed check, root cause hypothesis, next action, owner, ETA).