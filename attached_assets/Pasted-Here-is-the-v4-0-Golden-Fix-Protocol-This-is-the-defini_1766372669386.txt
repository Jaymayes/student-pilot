Here is the v4.0 "Golden Fix" Protocol. This is the definitive prompt designed to solve the root causes: the unsupported offline_access scope and the REPL_ID conflict.Copy and paste the entire block below into your AI Agent's interface:Markdown# üîß MASTER PROTOCOL: THE GOLDEN FIX (v4.0)

**ROLE:** Lead Security Architect & Release Engineer
**OBJECTIVE:** Execute the "Final Polish" remediation. Fix the OIDC Scope error, remove conflicting Secrets, and sync the Production Builds.

## üõë PHASE 1: MANDATORY INITIALIZATION (LOGIC GATE)

**CRITICAL INSTRUCTION:**
You have instructions for 8 applications. **You must NOT execute them all.**

1.  **DETECT:** Analyze your environment (`APP_BASE_URL`, `package.json`, directory) to identify your **ONE** App ID.
2.  **LOCK:** Select your specific **Suite** below. **IGNORE** all others.
3.  **HANDSHAKE:** Output this log before acting:

> **üîß GOLDEN FIX AGENT ONLINE**
> **CURRENT APP ID:** [Insert Detected ID]
> **TARGET URL:** [Insert Detected URL]
> **ACTION:** Removing 'offline_access', deleting 'REPL_ID', and verifying Release.

---

## üìÇ APPLICATION REGISTRY & KNOWN ISSUES

| APP ID | BASE URL | KNOWN ISSUE (FIX THIS) |
| :--- | :--- | :--- |
| **scholar_auth** | `https://scholar-auth-jamarrlmayes.replit.app` | **CRITICAL:** OIDC Scope Error (`offline_access`) & REPL_ID Conflict. |
| **scholarship_api** | `https://scholarship-api-jamarrlmayes.replit.app` | **WARN:** High Search Latency (>900ms). |
| **provider_register** | `https://provider-register-jamarrlmayes.replit.app` | **CRITICAL:** Prod returns 500 (Stale Build). |
| **student_pilot** | `https://student-pilot-jamarrlmayes.replit.app` | **PASS:** Revenue Config Check. |
| *(All Others)* | `...` | **PASS:** Run Sanity Check. |

---

## üìù PHASE 2: REPORTING HEADER

**RULE:** Start every output with:

```text
REMEDIATION REPORT
==================
APP ID: [Insert ID]
TIMESTAMP: [ISO8601]
--------------------------------------------------
‚öôÔ∏è PHASE 3: FIX & VERIFY SUITES (EXECUTE ONLY ONE)Find your APP ID below. Execute ONLY that section.üî¥ SUITE 1: scholar_auth (The Revenue Gatekeeper)Step 1: Fix OIDC Scope Error (P0 - ROOT CAUSE)Context: Replit OIDC does not support the offline_access scope for hosted apps. Requesting it causes a "Server Error".Action: Search server/index.ts, server/auth.ts, and server/replitAuth.ts for the string scope:.FIX: Change the scope value to strictly: 'openid email profile'.CRITICAL: You MUST remove offline_access from the list.Step 2: Fix REPL_ID ConflictContext: A manual REPL_ID secret overrides the platform auto-injection, causing a Client ID mismatch in production.Action: Check Environment Secrets.FIX: DELETE the REPL_ID secret completely. (Let the platform handle it).Step 3: Remove StripeAction: Delete stripe from package.json and Disconnect "Stripe Integration" in Replit UI if present.Step 4: VerificationAction: GET /health. ASSERT: Status 200.Trigger: Output "‚ö†Ô∏è MANUAL ACTION: Click 'Republish' immediately to deploy the Scope Fix."üü£ SUITE 6: provider_register (Deployment Repair)Step 1: Production DiagnosisAction: GET https://provider-register-jamarrlmayes.replit.app/healthz (External).Condition: Status 500 or 404.Fix Action: Run npm run build locally to ensure the build artifacts are valid.Output: "‚ö†Ô∏è ACTION REQUIRED: Manual Republish needed to sync the healthy build."Step 2: VerificationAction: GET /. ASSERT: Status 200 (Homepage loads).üü† SUITE 2: scholarship_api (Performance)Step 1: Latency FixAction: Check Database Indexes.Fix: CREATE INDEX IF NOT EXISTS idx_scholarships_title ON scholarships(title);Step 2: VerificationAction: GET /search?q=engineering. ASSERT: Time < 900ms.üîµ SUITE 5: student_pilot (Revenue Check)Step 1: Revenue ConfigAction: Scan for VITE_STRIPE_PUBLIC_KEY.ASSERT: Key exists and starts with pk_live_ or pk_test_.Step 2: VerificationAction: GET /api/checkout (Unauth). ASSERT: Status 401.‚ö™ OTHER APPS (scholarship_agent, scholarship_sage, auto_page_maker, auto_com_center)Step 1: Golden Path VerificationAction: GET /health. ASSERT: Status 200.Action: GET /. ASSERT: Status 200.üèÅ PHASE 4: FINAL SIGN-OFFINSTRUCTION: Output the final status table.App IDStatusFix Applied?[Your ID]PASS / FAIL[Yes (Details) / No]End of Protocol.